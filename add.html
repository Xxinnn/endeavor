<script src="js/jquery.min.js"></script>
<script src="js/papaparse.min.js"></script>
<script>
        $(window).load(function() {
            window.onmessage=function(e){
                if(e.data == 'show_twine') {
                    alert('It works');
                }
            }
            //Binding click events to lately loaded htmlelements
            

            
            var answer;
            var answerArray=[];
            var seconds;
            var storySeconds=[];
            var myData = [];
            $('body').on({
                mousedown: function() { 
                    answer=($(this).attr('data-passage'));
                    console.log(answer);
        
                    answerArray.push(answer);
//                    myTimeVariable.now()
                    seconds = new Date().getTime() / 1000 | 0;
                    console.log(seconds);
                                myData.push([answer, seconds]);
                    storySeconds.push(seconds);
                   
                    var data = Papa.unparse(myData);
                        //var filename = 'easy.csv';
                        var saveData = (function () {
                           var a = document.createElement("a");
                           document.body.appendChild(a);
                           a.style = "display: none";
                           return function (data, fileName) {
                               var blob = new Blob([data], {type: "octet/stream"}),
                                   url = window.URL.createObjectURL(blob);
                               a.href = url;
                               a.download = fileName;
                               a.click();
                               window.URL.revokeObjectURL(url);
                           };
                       }());
                    
                    //maze
                    if(answer==='Treasure Door Best'){
                        window.parent.postMessage(
                        {
                            event_id: 'best',
                            data: {
                                v1: myData, 
                                //v2: 'value2'
                            }
                        }, 
                        "*" //or "www.parentpage.com"
                        ); 
//                        var filename = 'wc1.csv';
//                        saveData(data, filename);
                    } 
                    
                    if(answer==='Treasure Door Good'){
                        window.parent.postMessage(
                        {
                            event_id: 'good',
                            data: {
                                v1: myData, 
                                //v2: 'value2'
                            }
                        }, 
                        "*" //or "www.parentpage.com"
                        ); 
                    }
                    
                    if(answer==='Treasure Door Decent'){
                        window.parent.postMessage(
                        {
                            event_id: 'decent',
                            data: {
                                v1: myData, 
                                //v2: 'value2'
                            }
                        }, 
                        "*" //or "www.parentpage.com"
                        ); 
                    } 
                    if(answer==='Treasure Door Poor'){
                        window.parent.postMessage(
                        {
                            event_id: 'poor',
                            data: {
                                v1: myData, 
                                //v2: 'value2'
                            }
                        }, 
                        "*" //or "www.parentpage.com"
                        ); 
                    } 
                    if(answer==='native best'){
                        window.parent.postMessage(
                        {
                            event_id: 'double',
                            data: {
                                v1: myData, 
                                //v2: 'value2'
                            }
                        }, 
                        "*" //or "www.parentpage.com"
                        ); 
                    }
                    
                    if(answer==='native good'){
                        window.parent.postMessage(
                        {
                            event_id: 'one_and_half',
                            data: {
                                v1: myData, 
                                //v2: 'value2'
                            }
                        }, 
                        "*" //or "www.parentpage.com"
                        ); 
                    } 
                    
                    //give
                    if(answer==='Give them half of your gold.'){
                        window.parent.postMessage(
                        {
                            event_id: 'give_half',
                            data: {
                                v1: myData, 
                                v2: 'value2'
                            }
                        }, 
                        "*" //or "www.parentpage.com"
                        ); 
                        
                    } 
                    if(answer==='Give them a little bit of your gold.'){
                        window.parent.postMessage(
                        {
                            event_id: 'give_little',
                            data: {
                                v1: myData, 
                                //v2: 'value2'
                            }
                        }, 
                        "*" //or "www.parentpage.com"
                        ); 

                    }
                    
                    //pirate
                    if(answer==='rug'){
                        window.parent.postMessage(
                        {
                            event_id: 'pirate-good',
                            data: {
                                v1: myData, 
                                //v2: 'value2'
                            }
                        }, 
                        "*" //or "www.parentpage.com"
                        ); 
                    } 
                    if(answer==='4-decent'){
                        window.parent.postMessage(
                        {
                            event_id: 'pirate-decent',
                            data: {
                                v1: myData, 
                                //v2: 'value2'
                            }
                        }, 
                        "*" //or "www.parentpage.com"
                        ); 
                    }
                    
                    if(answer==='4-poor'){
                        window.parent.postMessage(
                        {
                            event_id: 'pirate-poor',
                            data: {
                                v1: myData, 
                                //v2: 'value2'
                            }
                        }, 
                        "*" //or "www.parentpage.com"
                        ); 
                    }
                    
                    if(answer==='Go Back Home'){
                        window.parent.postMessage(
                        {
                            event_id: 'end',
                            data: {
                                v1: myData, 
                                //v2: 'value2'
                            }
                        }, 
                        "*" //or "www.parentpage.com"
                        ); 
                        var filename = 'userTest.csv';
                        
                        saveData(data, filename);
                    }
                    
                    window.top.postMessage("bye","*"); }
                
            }, '.link-internal');
            
            window.addEventListener('message', function(event) {
            if(event.data.event_id === 'show_twine'){
                myData = event.data.data.v1;
                //alert("We passed the data");
            }
            //breakPoint="here";
                             
        });
            
            
            
                //'hover','.link-internal', function(){
            //alert('document is always there');
        });
        
        
        //});
    </script>